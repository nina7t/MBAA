<parameter name="content">/**
 * Events Gallery JavaScript
 * Gestion de la galerie photos des événements
 */

document.addEventListener('DOMContentLoaded', function() {
    initGallery();
    initLightbox();
    initFilters();
});

/**
 * Initialiser la galerie
 */
function initGallery() {
    const galleryGrid = document.querySelector('.events-gallery__grid');
    if (!galleryGrid) return;

    // Charger plus de photos au clic
    const loadMoreBtn = document.querySelector('.gallery-load-more__btn');
    if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', function() {
            loadMorePhotos(this);
        });
    }

    console.log('Events Gallery initialized');
}

/**
 * Initialiser le lightbox
 */
function initLightbox() {
    const lightbox = document.querySelector('.lightbox');
    if (!lightbox) return;

    const closeBtn = lightbox.querySelector('.lightbox__close');
    const prevBtn = lightbox.querySelector('.lightbox__nav--prev');
    const nextBtn = lightbox.querySelector('.lightbox__nav--next');

    // Fermer le lightbox
    if (closeBtn) {
        closeBtn.addEventListener('click', closeLightbox);
    }

    // Navigation
    if (prevBtn) {
        prevBtn.addEventListener('click', () => navigateLightbox(-1));
    }
    if (nextBtn) {
        nextBtn.addEventListener('click', () => navigateLightbox(1));
    }

    // Fermer avec Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && lightbox.classList.contains('lightbox--active')) {
            closeLightbox();
        }
        if (e.key === 'ArrowLeft') navigateLightbox(-1);
        if (e.key === 'ArrowRight') navigateLightbox(1);
    });

    // Fermer en cliquant à côté
    lightbox.addEventListener('click', function(e) {
        if (e.target === lightbox) {
            closeLightbox();
        }
    });
}

/**
 * Ouvrir le lightbox
 */
function openLightbox(photoCard) {
    const lightbox = document.querySelector('.lightbox');
    if (!lightbox) return;

    const image = photoCard.querySelector('.photo-card__image');
    const title = photoCard.querySelector('.photo-card__title');
    const meta = photoCard.querySelector('.photo-card__meta');

    const lightboxImage = lightbox.querySelector('.lightbox__image');
    const lightboxTitle = lightbox.querySelector('.lightbox__title');
    const lightboxMeta = lightbox.querySelector('.lightbox__meta');

    if (lightboxImage && image) {
        lightboxImage.src = image.src;
        lightboxImage.alt = image.alt;
    }
    if (lightboxTitle && title) {
        lightboxTitle.textContent = title.textContent;
    }
    if (lightboxMeta && meta) {
        lightboxMeta.innerHTML = meta.innerHTML;
    }

    lightbox.classList.add('lightbox--active');
    document.body.style.overflow = 'hidden';
}

/**
 * Fermer le lightbox
 */
function closeLightbox() {
    const lightbox = document.querySelector('.lightbox');
    if (!lightbox) return;

    lightbox.classList.remove('lightbox--active');
    document.body.style.overflow = '';
}

/**
 * Naviguer dans le lightbox
 */
function navigateLightbox(direction) {
    const cards = document.querySelectorAll('.photo-card:not([style*="display: none"])');
    const lightbox = document.querySelector('.lightbox');
    if (!lightbox || cards.length === 0) return;

    const currentImage = lightbox.querySelector('.lightbox__image');
    if (!currentImage) return;

    // Trouver l'index actuel
    let currentIndex = 0;
    cards.forEach((card, index) => {
        const image = card.querySelector('.photo-card__image');
        if (image && image.src === currentImage.src) {
            currentIndex = index;
        }
    });

    // Calculer le nouvel index
    let newIndex = currentIndex + direction;
    if (newIndex < 0) newIndex = cards.length - 1;
    if (newIndex >= cards.length) newIndex = 0;

    // Ouvrir la nouvelle image
    const newCard = cards[newIndex];
    if (newCard) {
        openLightbox(newCard);
    }
}

/**
 * Initialiser les filtres
 */
function initFilters() {
    const filterBtns = document.querySelectorAll('.events-gallery__filter');

    filterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const filter = this.dataset.filter;

            // Update active state
            filterBtns.forEach(b => b.classList.remove('events-gallery__filter--active'));
            this.classList.add('events-gallery__filter--active');

            // Filter photos
            filterPhotos(filter);
        });
    });
}

/**
 * Filtrer les photos
 */
function filterPhotos(filter) {
    const cards = document.querySelectorAll('.photo-card');

    cards.forEach(card => {
        const category = card.dataset.category;

        if (filter === 'all' || category === filter) {
            card.style.display = '';
        } else {
            card.style.display = 'none';
        }
    });

    // Update counter
    updatePhotoCounter();
}

/**
 * Mettre à jour le compteur de photos
 */
function updatePhotoCounter() {
    const counter = document.querySelector('.events-gallery__count');
    const visibleCards = document.querySelectorAll('.photo-card:not([style*="display: none"])');

    if (counter && visibleCards.length > 0) {
        const total = document.querySelectorAll('.photo-card').length;
        counter.textContent = `${visibleCards.length} / ${total} photos`;
    }
}

/**
 * Charger plus de photos
 */
function loadMorePhotos(button) {
    const originalText = button.textContent;
    button.disabled = true;
    button.innerHTML = '<span class="loading-spinner"></span> Chargement...';

    // Simuler un chargement
    setTimeout(() => {
        button.disabled = false;
        button.textContent = originalText;

        // Ici vous pouvez ajouter du code pour charger真正的 des photos
        // Par exemple : fetch('/api/photos?offset=12')
    }, 1000);
}

// ==========================================
// CLIC SUR LES PHOTOS
// ==========================================
document.addEventListener('click', function(e) {
    const photoCard = e.target.closest('.photo-card');
    if (photoCard && !e.target.closest('.photo-card__zoom')) {
        openLightbox(photoCard);
    }
});

console.log('Events Gallery JS loaded successfully');
</parameter>
